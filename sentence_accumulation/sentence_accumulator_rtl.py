import re
from ufal.udpipe import Model, Pipeline

class ArabicSentenceSplitter:
    def __init__(self, model_path):
        self.model = Model.load(model_path)
        if not self.model:
            raise ValueError(f"Cannot load model from file '{model_path}'")
        self.pipeline = Pipeline(self.model, 'tokenize', Pipeline.DEFAULT, Pipeline.DEFAULT, 'conllu')

    def split_sentences(self, text):
        processed = self.pipeline.process(text)
        sentences = []
        sentence = ''
        print(f"processed : {processed}")
        for line in processed.split('\n'):
            if line.startswith('# text = '):
                if sentence:
                    sentences.append(sentence.strip())
                sentence = line[9:]
            elif not line.strip() and sentence:
                sentences.append(sentence.strip())
                sentence = ''
        if sentence:
            sentences.append(sentence.strip())
        return sentences

class SentenceAccumulatorArabic:
    def __init__(self, model_path):
        self.sentence_splitter = ArabicSentenceSplitter(model_path)
        self.buffer = ""

    def process_segment(self, text):
        self.buffer += text.strip() + " "
        sentences = self.sentence_splitter.split_sentences(self.buffer)
        
        if sentences:
            completed_sentences = sentences[:-1]  # Убираем последнее, если оно неполное
            self.buffer = sentences[-1] if sentences[-1] not in completed_sentences else ""
            return completed_sentences
        return []


arabic_text1 = [
    "المرأة في الإسلام",
    "لها مكانة عظيمة",
    "وحقوق كثيرة الله",
    "سبحانه وتعالى جعلها",
    "شريكًا للرجل في الحياة",
    "وأعطاها حقوقًا وواجبات",
    "من المهم أن نذكر",
    "أن المرأة لها الحق",
    "في التعليم والعمل",
    "والمشاركة في المجتمع الإسلام",
    "يحث على احترام",
    "المرأة وتقديرها كما أن",
    "للمرأة الحق في",
    "اختيار زوجها، والعيش بكرامة",
    "وأمان يجب علينا جميعًا",
    "أن نعمل على تعزيز",
    "حقوق المرأة ودعمها في",
    "كل المجالات المرأة جزء",
    "أساسي من المجتمع، ونجاحها",
    "هو نجاح لنا جميعًا",
    "الله سبحانه وتعالى في",
    "القرآن الكريم دعا إلى",
    "العدل والمساواة بين الرجل",
    "والمرأة لذا، يجب أن",
    "نكون حريصين على",
    "تطبيق هذه المبادئ في حياتنا",
    "اليومية دعونا نعمل معًا",
    "من أجل مستقبل أفضل",
    "للنساء في مجتمعاتنا إن",
    "تمكين المرأة ليس مجرد",
    "شعار، بل هو واجب",
    "ديني واجتماعي علينا أن",
    "ندعمها في تحقيق أحلامها",
    "وطموحاتها المرأة لها دور",
    "كبير في بناء الأسرة",
    "والمجتمع، ويجب أن نحترم",
    "هذا الدور ونعززه لنكن",
    "جميعًا دعاة للسلام",
    "والعدل والمساواة، ولنبدأ بأنفسنا",
    "وبعائلاتنا في تحقيق",
    "هذه القيم النبيلة إن",
    "المرأة هي الأم والأخت",
    "والزوجة، وهي تستحق كل",
    "الاحترام والحب والدعم فلنعمل",
    "معًا من أجل عالم يحتضن",
    "الجميع بالحب والعدالة"
]
arabic_text2 = [ 
    "أخذت دورة في الإنجليزي وفي الحاسب الآلي", 
    "دور ان يمكن غيري. الكريم يعتقد الكثير بان تمكين المرأة هو", 
    "بان تمكين المرأة هو شعارات تطلق. بأنها مهمة سهلة ومشروع", 
    "بسيط. والحقيقة التي تخفى على الكثير باننا جميعا ملجهنا متاعب", 
    "هي في سبيل المثال للمرأة", 
    "البعض منها للأسف سكك في تربيتها ودينها بسبب عملها في تمكين المرأة", 
    "البعض منا للأسف واجهت متاعب من أهلها وأقرب الناس إليها", 
    "بسبب ظهورها وعملها لتمكين المرأة", 
    "المرأة. البعض منها للأسف خمشت واستغلت. لانها ارادت ان تكون", 
    "تكون جزء فعال في المجتمع وليس عالة عليه", 
    "ايها الاخوة والاخلات", 
    "بل احد اهم المشاريع التنموية", 
    "واكثرها حساسية", 
    "واكثرها حساسية", 
    "وشريعة تنموية وأكثرها حساسية وجهدا", 
    "وجودنا اليوم في هذا المكان تعبير واضح وقوي عن نجاحنا", 
    "عن نجاحنا", 
    "في مدينة رائدة", 
    "في مدينة رائدة", 
    "لهدف إنساني", 
    "لو لا تنفيق الله", 
    "لو لا تنفيق الله", 
    "ثم نجاح المرأة العربية وعزيمة وإرادة كل امرأ منكم", 
    "نرسل اليوم رسالة صارمة للجميع", 
    "بأن المرأة العربية مجتمع قادم في التنمية السياسية", 
    "في التنمية الاقتصادية والمشاركة", 
    "حواجز ولن يمنعها", 
    "أيها الحضور الكريم", 
    "نجح البعض في تصوير تمكين المرأة على أنه مشروع ملاقظ لديننا ضد عاداتنا وتقاليدنا", 
    "نحن هنا اليوم لنؤكد بأن دور المرأة القيادين هو حق المشروع أعطاه لنا ديننا قبل أي شيء في العالم", 
    "في العالم. نحن هنا اليوم لنؤكد بان المرأة جزءا من المجتمع.", 
    "جزءا من المجتمع", 
    "بحاجة المرأة", 
    "بحاجة المرأة", 
    "يسور البعض بأن تمكين المرأة يتطلب الأخذ من حقوق الرجل", 
    "الرجل. لكن الحقيقة الراجل والمرأة شريكين في هذا المشروع", 
    "ليخلقوا معا تنمية شاملة. نحن هنا اليوم لنؤكد الحق التي يخفيها", 
    "الحقيقة التي يخفيها الجميع بأن أول المستفيدين من تمكين المرأة هو الرجل", 
    "وبأن المرأة كذلك لا تستغني عن مشاركة الرجل ودعمه", 
    "ودعمه", 
    "أكبر مثال على ذلك", 
    "سمو الشيخ محمد الراشد", 
    "لأنه تبنى رسالة تمكين المرأة ليس فقط في عمله ولكن ابتدأ من داخل منزله", 
    "منزله. فنراه يدعم القياديات من افراد عائلته في شتى المجالات.", 
    "ومنهم سمو الشيخة منال اللي جمعتنا جامعا اليوم", 
    "فشكرا لكم لأنكم قدوة في الإيمان بتمكين المرأة قلبا وقالبا", 
    "التحدي الحقيقي اليوم ليس تحادياً دينياً", 
    "ليس تحديا مع الرجل أو تحديا اقتصادييا أو سياسيا", 
    "التحدي الذي نواجهه اليوم هو الصراع بين التأخر والحضارة", 
    "والحضارة بين الماضي والمستقبل. بين الرجعية والتنمية. وخيارنا", 
    "واضح سنين السابقة", 
    "نجحنا في السنين السابقة في إنهاء التمييز ضد المرأة بشكل متفاوت في دولنا العربية", 
    "إلى حد ما في كثير من الدول أصبحت المرأة مساوية للرجل", 
    "الحقوق والواجبات والمناصب. فمثلما ادهينا التمييز بقوانيننا", 
    "وانظمتنا علينا اليوم ان ننهي هذا التمييز في عقولنا وقلوبنا.", 
    "اذهاننا والاحاسيس التي قد تدفعنا للوراء من قلونا نمشي", 
    "اذهاننا والاحاسيس التي قد تدفعنا للوراء من قلونا نمشي", 
    "وأخواتنا حينما يردن أن يعملن وأن يأخذن تحدي في حياتهم", 
    "فلندفعهم إلى الأمام", 
    "مثلما حنان دفعت بنفسها والآن تساهم في دعاء الكثير من الفتيات إلى الأمان", 
    "دعم بعضنا البعض", 
    "اتفال ببعاضنا", 
    "نبدأ في دعم بعضنا البعض", 
    "في الاحتفال ببعاضنا", 
    "الώρα نبدا بابناء المستقبل", 
    "المرأة العربية القيادية", 
    "المرأة العربية القيادية", 
    "المرأة العربية القيادية", 
    "قادمة قائمة بتنفيق المنح وبهمتكم وبدعم قياداتنا. شكرا", 
    "وبإذن الله بتوفيق المنح وبهمتكم وبدعم قياداتنا", 
    "شكرا لكم", 
    "السلام عليكم ورحمة الله وبركاته" 
]
arabic_text3 = [
    ".المرأة في الإسلام لها",
    ".مكانة عظيمة وحقوق كثيرة",
    "الله سبحانه وتعالى جعلها",
    "شريكًا للرجل في الحياة،",
    ".وأعطاها حقوقًا وواجبات",
    "من المهم أن نذكر",
    "أن المرأة لها الحق",
    "في التعليم والعمل والمشاركة",
    ".في المجتمع",
    "الإسلام يحث على",
    ".احترام المرأة وتقديرها",
    "كما أن للمرأة الحق",
    "في اختيار زوجها،",
    ".والعيش بكرامة وأمان",
    "يجب علينا جميعًا أن",
    "نعمل على تعزيز حقوق",
    "المرأة ودعمها في كل",
    ".المجالات",
    "المرأة جزء أساسي من",
    "المجتمع، ونجاحها هو نجاح",
    ".لنا جميعًا",
    "الله سبحانه وتعالى في",
    "القرآن الكريم دعا إلى",
    "العدل والمساواة بين",
    ".الرجل والمرأة",
    "لذا، يجب أن نكون",
    "حريصين على تطبيق هذه",
    ".المبادئ في حياتنا اليومية",
    "دعونا نعمل معًا من",
    "أجل مستقبل أفضل للنساء",
    ".في مجتمعاتنا",
    "إن تمكين المرأة ليس",
    "مجرد شعار، بل هو",
    ".واجب ديني واجتماعي",
    "علينا أن ندعمها في",
    ".تحقيق أحلامها وطموحاتها",
    "المرأة لها دور كبير",
    "في بناء الأسرة والمجتمع،",
    ".ويجب أن نحترم هذا",
    ".الدور ونعززه",
    "لنكن جميعًا دعاة للسلام",
    "والعدل والمساواة، ولنبدأ",
    "بأنفسنا وبعائلاتنا في تحقيق",
    ".هذه القيم النبيلة",
    "إن المرأة هي الأم",
    "والأخت والزوجة، وهي",
    "تستحق كل الاحترام والحب",
    ".والدعم",
    "فلنعمل معًا من أجل",
    "عالم يحتضن الجميع بالحب",
    ".والعدالة"
]



model_path = 'arabic-padt-ud-2.5-191206.udpipe'
print(len(arabic_text3))
accumulator = SentenceAccumulatorArabic(model_path)
cccc = 0
# for segment in arabic_text3:
#     completed_sentence = accumulator.process_segment(segment)
#     if completed_sentence:
#         cccc += 1
#         print("Completed Sentence:", completed_sentence)

print("".join(arabic_text3))
